---
title: "Registry"
classes: wide
header:
  teaser: /assets/images/CTF/Reg/logo.jpg
ribbon: Red
description: "RE CSC CTF "
categories:
  - CTF
toc: true
---

### Analysis :

First when I Download this challenge i take first shot by reg shot tool after that I run sample and after it finish I take second shot but I didn't found any thing useful so I open the challenge by notebad++

![](/assets/images/CTF/Reg/notepad++.PNG)
You can see  file contain 4 parts 

1) Regkey[HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce]
Which make his value PART2 
2) At second part you found powershell script which is search at C: for file with len 0x00026A83 and has extension .REG ,then I copy the content of file to tmpreg.bat  
3) another powershell script which which take tmpreg.bat and XOR it content after it skip 000643 byte and put the encoding file a    tmp + random +.exe
4) Random Values

Know we have abstract knowledge to know what is it done here 
I ran the sample and go to regedit


![](/assets/images/CTF/Reg/regedit.PNG)

This key work when we restart machine 


After restarting I go to %temp% and found this files .

![](/assets/images/CTF/Reg/tempo.PNG)


I will make analysis for  tmp1224721815.exe
When I run it close quickly 

so I open it at ida and when see strings I found EGCRT{ Which is the start of the flag so I know I'm at on the right way
![](/assets/images/CTF/Reg/strings ida pro.PNG)



![](/assets/images/CTF/Reg/Egcert.PNG)


 When I open the function that use this string I found It assemble the Flag at two part first char by char and second block by block

First Part: 
![](/assets/images/CTF/Reg/firstpart.PNG)

Second Part: 
![](/assets/images/CTF/Reg/secondpart.PNG)

When I was debugging I didn't found any problem but at second part 
I was hit with memory exception so I will split the second part to explain where is it happening 


You found here {getenv} function which return value of environment variable 
But I found it pass var name doesn’t exist and then check if the return value is zero which every iteration is zero or value that not reference to memory address then It get value from reference [rbx+r13*8]and compare it with the return value which made memory exception

![](/assets/images/CTF/Reg/firstsecond.PNG)


I patch the jnz to je and change value of RAX every iteration to avoid memory exception 
And if the compare not equal it jump to bad decision else add it to flag
And then add {_} 


![](/assets/images/CTF/Reg/secondsecond.PNG)



After the all iteration that the flag assembled at Destination 
Flag : EGCERT{r3v3rseing_r3g_f1l3s_with_3mb3dd3d_ex3cutabl3_c0d3_9ccb6bd3}




